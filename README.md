# java-filmorate
Template repository for Filmorate project.

![Диаграмма БД filmorate-project](https://raw.githubusercontent.com/AlexanderTuzhikov/java-filmorate/90f03d66dcb3b66b95d9dd997a3bc56230a548a5/Filmorate%20project.png)

## Описание схемы базы данных Filmorate

Данная схема описывает структуру базы данных проекта **Filmorate** — сервиса для оценки фильмов, добавления друзей и формирования рейтингов по лайкам пользователей.

База данных реализует связи между пользователями, фильмами, жанрами и возрастными рейтингами (MPA), а также хранит информацию о дружбе и статусах отношений между пользователями.

---

### Основные таблицы

**`films`** — хранит основную информацию о фильмах:  
- `film_id` — первичный ключ  
- `name`, `description`, `releaseDate`, `duration` — характеристики фильма  
- `mpa_id` — ссылка на возрастной рейтинг (таблица `MPA`)

**`users`** — содержит данные о пользователях:  
- `user_id` — первичный ключ  
- `email`, `login`, `name`, `birthday` — регистрационные данные пользователя

**`genres`** — справочник жанров фильмов  
**`mpa`** — справочник возрастных рейтингов

---

### Таблицы связей (многие ко многим)

**`films_genres`** — связывает фильмы и жанры  
- Составной ключ `(film_id, genre_id)` обеспечивает уникальность пары

**`films_likes`** — хранит информацию о лайках фильмов пользователями  
- Составной ключ `(film_id, user_id)` предотвращает повторный лайк одного фильма одним пользователем

---

### Друзья и статусы

**`users_friends`** — хранит связи между пользователями (дружбу)  
- Составной ключ `(user_id, friend_id)`  
- `friendship_status_id` указывает на статус дружбы (например: «ожидание», «подтверждено»)

**`friendship_status`** — справочник статусов дружбы

---

## Основные SQL-запросы проекта Filmorate

Ниже приведены основные SQL-запросы для работы с таблицами `users`, `users_friends`, `films` и `films_likes`.  
Каждый запрос снабжён пояснением, что он делает.

---

### Пользователи

1. **Получить всех пользователей**

```sql
SELECT *
FROM users;

Выводит все строки из таблицы users.

Показывает user_id, email, login, name, birthday.

2. **Получить пользователя по ID**

```sql
SELECT *
FROM users
WHERE user_id = {id};

Возвращает одного пользователя с указанным user_id.

{id} нужно заменить на конкретное число или параметр.

3. **Получить друзей пользователя**

```sql
SELECT *
FROM users
WHERE user_id IN (
    SELECT friend_id
    FROM users_friends
    WHERE user_id = {id}
);


Внутренний подзапрос получает список ID друзей пользователя {id}.

Внешний запрос возвращает полные данные этих друзей.

4. **Получить общих друзей двух пользователей**

```sql
SELECT *
FROM users
WHERE user_id IN (
    SELECT friend_id
    FROM users_friends
    WHERE user_id = {id}
      AND friend_id IN (
          SELECT friend_id
          FROM users_friends
          WHERE user_id = {other_id}
      )
);


Находит друзей, которые есть одновременно у пользователя {id} и {other_id}.

Использует вложенные подзапросы для пересечения списков друзей.
